(()=>{"use strict";var t={d:(e,n)=>{for(var s in n)t.o(n,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:n[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Anchor:()=>L,FontColor:()=>v,FontDecoration:()=>b,FontSize:()=>f,Image:()=>x,List:()=>w,Video:()=>S});class n{constructor(t){this.listeners=[],this.state=t,n.activeListeners=[]}setState(t){this.state={...this.state,...t},this.listeners.map((t=>{n.activeListeners.find((e=>e===t))||n.activeListeners.push(t)})),n.timer&&(clearTimeout(n.timer),n.timer=0),n.timer=setTimeout((()=>{n.activeListeners.map((t=>t.update())),n.activeListeners=[]}),1)}subscribe(t){const e=this.listeners.filter((e=>e!==t));this.listeners=[...e,t]}unSubscribe(t){this.listeners=this.listeners.filter((e=>e!==t))}}class s{constructor(){this.fontSize=10}}const i=class extends n{constructor(){super(new s)}setStyleSize(t){this.setState({fontSize:t})}},o=(t,e)=>{let n=e;for(;n;){if(n===t)return!0;n=n.parentElement}return!1},r=(t,e)=>{if(Object.keys(e).map((e=>t.style.removeProperty(e))),t.childNodes.forEach((t=>{"#text"!==t.nodeName&&r(t,e)})),"SPAN"===t.nodeName&&0===t.style.length){const e=document.createTextNode(t.textContent);t.parentElement.replaceChild(e,t)}},a=(t,e)=>{if(t.childNodes.forEach((t=>{"#text"!==t.nodeName&&a(t,e)})),t.nodeName===e){const e=document.createDocumentFragment();t.childNodes.forEach((t=>e.appendChild(t))),t.parentElement.replaceChild(e,t)}},d=(t,e)=>{const n=Object.keys(e);if("#text"===t.nodeName){const s=document.createElement("span");n.map((t=>s.style.setProperty(t,e[t]))),s.textContent=t.textContent,t.parentElement?.replaceChild(s,t)}else n.map((n=>t.style.setProperty(n,e[n])))},h=(t,e)=>{let n=t;for(;n;){if(n.dataset.type===e)return n;n=n.parentElement}return null},l=(t,e)=>{let n=t;for(;n;){if(n.nodeName===e)return n;n=n.parentElement}return null},c=class{constructor(t){this.button=document.createElement("button"),this.type=t||"primary",this.render()}render(){return"primary"===this.type&&d(this.button,{background:"none",border:"none",color:"#0098f7","font-size":"18px",cursor:"pointer"}),"menu"===this.type&&d(this.button,{background:"none",border:"none",cursor:"pointer"}),this.button}set textContent(t){this.button.textContent=t}set innerHTML(t){this.button.innerHTML=t}},p=class{constructor(t){this.name=t,this.render()}render(){if(this.wrapper)return this.wrapper;const t=document.createElement("div");d(t,{padding:"8px 0"});const e=document.createElement("span");d(e,{display:"block","margin-bottom":"4px","font-size":"24px"}),e.textContent=`${this.name}: `;const n=document.createElement("input");return d(n,{width:"260px",height:"46px"}),t.appendChild(e),t.appendChild(n),this.input=n,this.wrapper=t,this.wrapper}set value(t){this.input.value=t}get value(){return this.input.value}};class u{constructor(){this.isOpen=!1}}const m=class extends n{constructor(){super(new u)}openModal(){this.setState({isOpen:!0})}closeModal(){this.setState({isOpen:!1})}toggleModal(){this.setState({isOpen:!this.state.isOpen})}},g=class{constructor(t,e,n){this.parent=t,this.root=n,this.store=new m,this.children=e,this.store.subscribe(this)}update(){this.store.state.isOpen?(this.root.range.saveTmp(),this.wrapper=document.createElement("div"),d(this.wrapper,{position:"absolute",left:"0",top:"100%",padding:"12px","border-radius":"8px","box-shadow":"0 3px 5px -1px rgba(0,0,0,0.2),0 6px 10px 0 rgba(0,0,0,0.14),0 1px 18px 0 rgba(0,0,0,0.12)","background-color":"#fff"}),this.parent.appendChild(this.wrapper),this.wrapper.appendChild(this.children),document.addEventListener("click",this.clickOutSide)):(this.root.range.initializeTmp(),this.parent.removeChild(this.wrapper),document.removeEventListener("click",this.clickOutSide))}clickOutSide=t=>{o(this.wrapper,t.target)||this.closeModal()};render(){}openModal(){this.store.openModal()}closeModal(){this.store.closeModal()}toggleModal(){this.store.toggleModal()}get isOpen(){return this.store.state.isOpen}};class f{constructor(t,e,n){this.parent=t,this.root=n,this.store=new i,this.render(),this.store.subscribe(this)}update(){this.button.textContent=`${this.store.state.fontSize}px`}render(){const t=document.createElement("div"),e=document.createElement("button"),n=document.createElement("button");e.textContent=`${this.store.state.fontSize}px`,n.textContent="setting",this.wrapper=t,this.button=e,this.menuOpenButton=n,this.inputWrapper=document.createElement("div"),this.modal=new g(this.wrapper,this.inputWrapper,this.root),this.fontSizeInputSetting(),this.wrapperSetting(),this.buttonSetting(),this.menuOpenButtonSetting(),t.appendChild(e),t.appendChild(n),this.parent.appendChild(t)}wrapperSetting(){d(this.wrapper,{position:"relative",padding:"4px"})}buttonSetting(){d(this.button,{border:"1px solid #aaa",padding:"8px 14px","background-color":"white"}),this.button.addEventListener("click",(()=>{this.root.range.setStyle({"font-size":`${this.store.state.fontSize}px`})}))}menuOpenButtonSetting(){d(this.menuOpenButton,{border:"1px solid #aaa","border-left":"none",padding:"8px 2px","background-color":"white"}),this.menuOpenButton.addEventListener("click",(()=>{this.modal.toggleModal()}))}fontSizeInputSetting(){const t=new p("size");t.input.defaultValue=this.store.state.fontSize.toString();const{button:e}=new c;e.addEventListener("click",(()=>{isNaN(Number(t.value))||this.store.setStyleSize(Number(t.value)),this.modal.closeModal()})),e.textContent="OK",this.inputWrapper.appendChild(t.wrapper),this.inputWrapper.appendChild(e)}}class v{constructor(t,e,n){this.parent=t,this.root=n;const s=document.createElement("div");this.wrapper=s,this.openButton=new c("menu").button,this.openButton.innerHTML="ðŸ”½",this.applyButton=new c("menu").button,this.applyButton.innerHTML="A",this.contentsWrapper=document.createElement("div"),this.modal=new g(this.wrapper,this.contentsWrapper,n);const i=document.createElement("input");i.type="color",this.colorPicker=i;const o=document.createElement("input");o.type="color",this.backgroundPicker=o,this.wrapper.appendChild(this.applyButton),this.wrapper.appendChild(this.openButton),this.wrapper.appendChild(this.colorPicker),this.parent.appendChild(s),this.render(),this.root.fontColorStore.subscribe(this)}render(){d(this.colorPicker,{display:"none"}),d(this.wrapper,{display:"flex",position:"relative",border:"1px solid black",margin:"4px"}),d(this.applyButton,{"font-size":"24px","font-weight":"500",color:this.root.fontColorStore.state.color,background:this.root.fontColorStore.state.background,"border-right":"1px solid black"}),this.applyButton.addEventListener("click",(()=>{this.root.range.setStyle({color:this.root.fontColorStore.state.color,background:this.root.fontColorStore.state.background})})),this.colorPicker.addEventListener("change",(t=>{this.root.fontColorStore.setColor(t.target.value)})),this.backgroundPicker.addEventListener("change",(t=>{this.root.fontColorStore.setBackgroundColor(t.target.value)})),this.openButton.addEventListener("click",(()=>{this.modal.toggleModal()})),this.renderContents()}update(){d(this.applyButton,{color:this.root.fontColorStore.state.color,background:this.root.fontColorStore.state.background})}renderContents(){d(this.contentsWrapper,{display:"flex"}),this.contentsWrapper.appendChild(this.renderColorSelectContents("Text")),this.contentsWrapper.appendChild(this.renderColorSelectContents("Background"))}renderColorSelectContents(t){const e=document.createElement("div");d(e,{width:"160px",padding:"12px","box-sizing":"border-box"});const n=document.createElement("div");n.textContent=`${t} Color`;const s=(new c).button;return s.textContent="Select",s.addEventListener("click",(()=>{"Text"===t&&this.colorPicker.click(),"Background"===t&&this.backgroundPicker.click()})),e.appendChild(n),e.appendChild(s),e}}class b{constructor(t,e,n){const s=document.createElement("div");this.wrapper=s,this.root=n;const i=["underline","line-through","overline"].map((t=>this.menuButtonRender(t)));this.buttons=i.map((t=>s.appendChild(t))),t.appendChild(this.wrapper),this.root.fontColorStore.subscribe(this),this.root.range.subscribe(this),this.render()}render(){d(this.wrapper,{position:"relative",padding:"4px"}),this.renderButtons(),this.wrapper.addEventListener("click",(t=>{const e=h(t.target,"line");if(e){const t=e.dataset.value;this.root.range.state.textDecorationValues?.find((e=>t===e))?((t,e,n)=>{let s=t;for(;s;)s instanceof HTMLElement&&s.style.getPropertyValue(e)===n&&s.style.removeProperty(e),s=s.parentElement})(this.root.range.anchorNode,"text-decoration-line",t):this.root.range.setStyle({"text-decoration-line":t})}}))}update(){const t=this.root.range.state.textDecorationValues;this.renderButtons(t)}renderButtons(t){this.buttons.map((e=>{const n=e.dataset.value;t?.find((t=>n===t))?d(e,{background:"#00ffff"}):d(e,{background:"#efefef"})}))}menuButtonRender(t){const e=new c("menu").button;return e.textContent="A",e.dataset.type="line",e.dataset.value=t,d(e,{"text-decoration-line":t}),e}}class C{constructor(){this.mode="file"}}const y=class extends n{constructor(){super(new C)}setMode(t){this.setState({mode:t})}};class x{constructor(t,e,n){this.imageOptions=e?.image,this.parent=t,this.root=n,this.wrapper=document.createElement("div"),this.toggleButton=new c("menu").button,this.imageForm=document.createElement("div"),this.headerNav=document.createElement("div"),["file","url"].map((t=>{const e=document.createElement("button");e.textContent=t,this.headerNav.appendChild(e),e.type="button",e.dataset.type="type",e.dataset.value=t})),this.formBody=document.createElement("div"),this.store=new y,this.footerNav=document.createElement("div");const s=document.createElement("button");s.textContent="insert",s.type="submit",this.footerNav.appendChild(s),this.imageForm.appendChild(this.headerNav),this.imageForm.appendChild(this.formBody),this.imageForm.appendChild(this.footerNav),this.wrapper.appendChild(this.toggleButton),this.modal=new g(this.wrapper,this.imageForm,n),this.parent.appendChild(this.wrapper),this.render(),this.store.subscribe(this)}update(){this.renderHeaderNav(),this.renderFormBody(),this.renderFooterNav()}render(){d(this.wrapper,{position:"relative"}),this.renderHeaderNav(),this.renderFormBody(),this.renderFooterNav(),this.toggleButton.innerHTML='\n<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="24.000000pt" height="24.000000pt" viewBox="0 0 24.000000 24.000000"\n preserveAspectRatio="xMidYMid meet">\n<g transform="translate(0.000000,24.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path d="M24 187 c-3 -8 -4 -43 -2 -78 l3 -64 95 0 95 0 0 75 0 75 -93 3 c-72\n2 -94 0 -98 -11z m176 -67 l0 -60 -80 0 -80 0 0 60 0 60 80 0 80 0 0 -60z"/>\n<path d="M90 150 c0 -5 5 -10 10 -10 6 0 10 5 10 10 0 6 -4 10 -10 10 -5 0\n-10 -4 -10 -10z"/>\n<path d="M130 115 c-7 -9 -21 -13 -30 -10 -9 3 -23 -1 -30 -10 -11 -13 -5 -15\n49 -15 l61 0 -16 25 c-19 29 -18 29 -34 10z"/>\n</g>\n</svg>\n',this.toggleButton.addEventListener("click",(()=>{this.modal.toggleModal()})),this.headerNav.addEventListener("click",(t=>{const e=h(t.target,"type");e&&this.store.setMode(e.dataset.value)}))}renderHeaderNav(){d(this.headerNav,{display:"flex"}),this.headerNav.childNodes.forEach((t=>{d(t,{width:"40px",border:"none","font-size":"24px",cursor:"pointer"}),this.store.state.mode===t.dataset.value?d(t,{"background-color":"#0098f7"}):d(t,{"background-color":"#aaa"})}))}renderFooterNav(){d(this.footerNav,{display:"flex","justify-content":"flex-end"});const t=this.footerNav.childNodes.item(0);t.addEventListener("click",(()=>{this.urlInput?.value&&this.insertImage(this.urlInput.value),this.modal.closeModal()})),d(t,{background:"none",border:"none",color:"#0098f7","font-size":"18px",cursor:"pointer"}),"file"===this.store.state.mode?d(t,{display:"none"}):d(t,{display:"block"})}renderFormBody(){const t=document.createDocumentFragment();if(this.formBody.innerHTML="","file"===this.store.state.mode){const e=document.createElement("input");e.type="file",e.name="file",this.urlInput=void 0,e.addEventListener("change",(async t=>{let e="";e=this.imageOptions?.onUploadSingle?await this.imageOptions.onUploadSingle(t.target.files[0]):URL.createObjectURL(t.target.files[0]),this.insertImage(e),this.modal.closeModal()})),t.appendChild(e)}else{const e=new p("url");this.urlInput=e.input,t.appendChild(e.wrapper)}this.formBody.appendChild(t)}insertImage=t=>{this.root.range.insertImage(t),this.modal.closeModal()}}const w=class{constructor(t,e,n){const s=new c("menu").button;this.root=n,s.innerHTML='<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="24.000000pt" height="24.000000pt" viewBox="0 0 24.000000 24.000000"\n preserveAspectRatio="xMidYMid meet">\n<g transform="translate(0.000000,24.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path d="M20 180 c0 -5 5 -10 10 -10 6 0 10 5 10 10 0 6 -4 10 -10 10 -5 0\n-10 -4 -10 -10z"/>\n<path d="M70 180 c0 -6 32 -10 75 -10 43 0 75 4 75 10 0 6 -32 10 -75 10 -43\n0 -75 -4 -75 -10z"/>\n<path d="M20 120 c0 -5 5 -10 10 -10 6 0 10 5 10 10 0 6 -4 10 -10 10 -5 0\n-10 -4 -10 -10z"/>\n<path d="M70 120 c0 -6 32 -10 75 -10 43 0 75 4 75 10 0 6 -32 10 -75 10 -43\n0 -75 -4 -75 -10z"/>\n<path d="M20 60 c0 -5 5 -10 10 -10 6 0 10 5 10 10 0 6 -4 10 -10 10 -5 0 -10\n-4 -10 -10z"/>\n<path d="M70 60 c0 -6 32 -10 75 -10 43 0 75 4 75 10 0 6 -32 10 -75 10 -43 0\n-75 -4 -75 -10z"/>\n</g>\n</svg>\n',s.addEventListener("click",(()=>this.insertUList())),t.appendChild(s),setTimeout((()=>{t.parentElement.querySelector(".board").addEventListener("keydown",(t=>{"Tab"===t.key&&(t.preventDefault(),this.tabulList())}))}),11)}tabulList(){if("Range"===this.root.range.type)return;const t=l(this.root.range.anchorNode,"LI"),e=document.createElement("ul"),n=document.createElement("li");n.textContent=" ",e.appendChild(n),t&&(n.innerHTML=t.innerHTML,t.parentElement.replaceChild(e,t),this.root.range.changeFocusNode(n))}insertUList(){if("Range"===this.root.range.type)return;const t=l(this.root.range.anchorNode,"LI"),e=document.createElement("ul"),n=document.createElement("li");n.textContent=" ",e.appendChild(n),t?(n.innerHTML=t.innerHTML,t.parentElement.replaceChild(e,t),this.root.range.changeFocusNode(n)):this.root.range.insertNodeAndFoucs(e)}};class N{constructor(){this.mode="url"}}const E=class extends n{constructor(){super(new N)}setMode(t){this.setState({mode:t})}},S=class{constructor(t,e,n){this.root=n,this.options=e.video,this.wrapper=document.createElement("div"),this.parent=t,this.form=document.createElement("div"),this.modal=new g(this.wrapper,this.form,n),this.button=new c("menu").button,this.wrapper.appendChild(this.button),this.parent.appendChild(this.wrapper),this.store=new E,this.store.subscribe(this),this.render()}update(){this.formContentsRender()}render(){d(this.wrapper,{position:"relative"}),this.button.innerHTML='<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="24.000000pt" height="24.000000pt" viewBox="0 0 50.000000 50.000000"\n preserveAspectRatio="xMidYMid meet">\n\n<g transform="translate(0.000000,50.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path d="M10 250 l0 -210 240 0 240 0 0 210 0 210 -240 0 -240 0 0 -210z m50\n175 c0 -8 -7 -15 -15 -15 -8 0 -15 7 -15 15 0 8 7 15 15 15 8 0 15 -7 15 -15z\nm60 0 c0 -8 -9 -15 -20 -15 -11 0 -20 7 -20 15 0 8 9 15 20 15 11 0 20 -7 20\n-15z m60 0 c0 -8 -9 -15 -20 -15 -11 0 -20 7 -20 15 0 8 9 15 20 15 11 0 20\n-7 20 -15z m60 0 c0 -8 -9 -15 -20 -15 -11 0 -20 7 -20 15 0 8 9 15 20 15 11\n0 20 -7 20 -15z m60 0 c0 -8 -9 -15 -20 -15 -11 0 -20 7 -20 15 0 8 9 15 20\n15 11 0 20 -7 20 -15z m60 0 c0 -8 -9 -15 -20 -15 -11 0 -20 7 -20 15 0 8 9\n15 20 15 11 0 20 -7 20 -15z m60 0 c0 -8 -9 -15 -20 -15 -11 0 -20 7 -20 15 0\n8 9 15 20 15 11 0 20 -7 20 -15z m50 0 c0 -8 -7 -15 -15 -15 -8 0 -15 7 -15\n15 0 8 7 15 15 15 8 0 15 -7 15 -15z m-170 -175 c0 -3 -20 -17 -45 -32 l-45\n-28 0 60 0 60 45 -28 c25 -15 45 -29 45 -32z m-240 -175 c0 -8 -7 -15 -15 -15\n-8 0 -15 7 -15 15 0 8 7 15 15 15 8 0 15 -7 15 -15z m60 0 c0 -8 -9 -15 -20\n-15 -11 0 -20 7 -20 15 0 8 9 15 20 15 11 0 20 -7 20 -15z m60 0 c0 -8 -9 -15\n-20 -15 -11 0 -20 7 -20 15 0 8 9 15 20 15 11 0 20 -7 20 -15z m60 0 c0 -8 -9\n-15 -20 -15 -11 0 -20 7 -20 15 0 8 9 15 20 15 11 0 20 -7 20 -15z m60 0 c0\n-8 -9 -15 -20 -15 -11 0 -20 7 -20 15 0 8 9 15 20 15 11 0 20 -7 20 -15z m60\n0 c0 -8 -9 -15 -20 -15 -11 0 -20 7 -20 15 0 8 9 15 20 15 11 0 20 -7 20 -15z\nm60 0 c0 -8 -9 -15 -20 -15 -11 0 -20 7 -20 15 0 8 9 15 20 15 11 0 20 -7 20\n-15z m50 0 c0 -8 -7 -15 -15 -15 -8 0 -15 7 -15 15 0 8 7 15 15 15 8 0 15 -7\n15 -15z"/>\n</g>\n</svg>\n',this.button.addEventListener("click",(()=>{this.modal.toggleModal()})),this.formContentsRender()}formContentsRender(){switch(this.form.innerHTML="",this.renderHeaderContents(),this.store.state.mode){case"embedCode":break;case"file":this.renderFileFormContents();break;case"url":this.renderUrlFormContents()}this.renderFooterContents()}embeddedVideo(t){const e=this.parent.parentElement.querySelector(".board"),n=document.createElement("div");n.dataset.nodeName="IFRAME",d(n,{width:e.clientWidth-24+"px",height:(e.clientWidth-24)/16*9+"px",position:"relative"});const s=document.createElement("video");s.src=t,s.controls=!0,d(s,{width:"100%",height:"100%",display:"block"}),n.appendChild(s),this.root.range.insertNodeAndFoucs(n),this.modal.closeModal()}embeddedYoutube(t){this.parent.parentElement.querySelector(".board");const e=document.createElement("div"),n=document.createElement("div");e.dataset.nodeName="IFRAME",d(e,{width:"100%",height:"0","padding-bottom":"56.25%",position:"relative"});const s=document.createElement("iframe");s.src=`https://youtube.com/embed/${t}`;const i=document.createElement("div");d(i,{width:"100%",height:"100%",position:"absolute",left:"0",top:"0",cursor:"pointer","z-index":"100"}),d(n,{width:"100%",height:"100%",position:"absolute",left:"0",top:"0"}),d(s,{width:"100%",height:"100%",display:"block"}),n.appendChild(s),e.appendChild(i),e.appendChild(n),this.root.range.insertNodeAndFoucs(e),this.modal.closeModal()}renderFileFormContents(){const t=document.createElement("div");d(t,{padding:"8px"});const e=document.createElement("span");e.textContent="file";const n=document.createElement("input");n.name="file",n.type="file",d(n,{width:"260px",height:"46px"}),t.appendChild(e),t.appendChild(n),this.input=n,this.form.appendChild(t)}renderUrlFormContents(){const t=document.createElement("div"),e=new p("url");t.appendChild(e.wrapper),this.input=e.input,this.form.appendChild(t)}renderHeaderContents(){const t=document.createElement("div");["url","file"].map((t=>{const e=document.createElement("button");return e.textContent=t,e.dataset.type="type",e.dataset.value=t,e})).map((e=>t.appendChild(e))),t.addEventListener("click",(t=>{const e=h(t.target,"type");if(e){const t=e.dataset.value;this.store.setMode(t)}})),this.form.appendChild(t)}renderFooterContents(){const t=document.createElement("div"),e=new c;e.textContent="insert",t.appendChild(e.button),e.button.addEventListener("click",(async()=>{switch(this.store.state.mode){case"url":const t=(t=>{const e=document.createElement("a");return e.href=t,e.hostname})(this.input.value);if("youtu.be"===t){const t=this.input.value.split("/").pop();this.embeddedYoutube(t)}if("www.youtube.com"===t){const t=(t=>{const e=document.createElement("a");return e.href=t,e.search.replace("?","").split("=").reduce(((t,e,n,s)=>(n%2==0?t[e]="":t[s[n-1]]=e,t)),{})})(this.input.value).v;this.embeddedYoutube(t)}case"file":let e="";e=this.options?.onUpload?await(this.options?.onUpload(this.input.files[0])):URL.createObjectURL(this.input.files[0]),this.embeddedVideo(e)}})),this.form.appendChild(t)}};class L{constructor(t,e,n){this.wrapper=document.createElement("div"),this.root=n,this.inputForm=document.createElement("div"),this.button=new c("menu").button,this.button.innerHTML='\n<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="24.000000pt" height="24.000000pt" viewBox="0 0 24.000000 24.000000"\n preserveAspectRatio="xMidYMid meet">\n\n<g transform="translate(0.000000,24.000000) scale(0.100000,-0.100000)"\nfill="#000000" stroke="none">\n<path d="M26 154 c-34 -34 -8 -84 45 -84 40 0 37 18 -3 22 -28 2 -33 7 -33 28\n0 21 5 26 33 28 17 2 32 7 32 13 0 15 -57 10 -74 -7z"/>\n<path d="M140 161 c0 -6 15 -11 33 -13 27 -2 32 -7 32 -28 0 -21 -5 -26 -32\n-28 -41 -4 -44 -22 -4 -22 53 0 79 50 45 84 -17 17 -74 22 -74 7z"/>\n<path d="M70 120 c0 -5 23 -10 50 -10 28 0 50 5 50 10 0 6 -22 10 -50 10 -27\n0 -50 -4 -50 -10z"/>\n</g>\n</svg>\n',this.modal=new g(this.wrapper,this.inputForm,this.root),this.wrapper.appendChild(this.button),t.appendChild(this.wrapper),this.render()}render(){this.button.addEventListener("click",(()=>{this.modal.toggleModal()})),this.renderForm()}update(){}renderForm(){const t=new p("url"),e=new p("text"),{button:n}=new c;n.textContent="Insert",n.addEventListener("click",(()=>{const n=this.root.range,s=document.createElement("a");s.href=t.value,"Range"!==n.type&&(s.textContent=e.value),n.setStyle({},s),t.value="",e.value="",this.modal.closeModal()})),this.inputForm.appendChild(t.wrapper),this.inputForm.appendChild(e.wrapper),this.inputForm.appendChild(n)}}class k{constructor(t,e,n){this.parent=t,this.options=e,this.root=n,this.render()}render(){const t=document.createElement("div");d(t,{display:"flex","flex-wrap":"wrap","align-items":"center",position:"sticky",top:"0",left:"0",background:"white","border-bottom":"1px solid black","z-index":"999"});const n=e;this.options.menus?this.options.menus.map((e=>new n[e](t,this.options,this.root))):Object.keys(e).map((e=>new n[e](t,this.options,this.root))),this.parent.appendChild(t)}}class M{constructor(t,e,n){this.parent=t,this.root=n,this.render(),this.board.innerHTML=e.defaultValue||""}textAreaSetting(){this.hiddenTextArea.style.display="none"}boardSetting(){d(this.board,{width:"100%",padding:"24px","box-sizing":"border-box"}),this.board.contentEditable="true",this.board.classList.add("board"),this.board.addEventListener("keydown",(t=>{if(t.ctrlKey||t.metaKey){if("z"===t.key||"Z"===t.key)if(t.preventDefault(),t.shiftKey){const t=this.root.history.redo();t&&(this.board.innerHTML=t.join(""))}else{const t=this.root.history.undo();t&&(this.board.innerHTML=t.join(""))}return}const e=[];this.board.childNodes.forEach((t=>{e.push(t.outerHTML)})),this.root.history.setNextChild(e,!0),this.hiddenTextArea.value=this.board.innerHTML,(0===this.board.childNodes.length||this.board.childNodes.length<=1&&"BR"===this.board.childNodes.item(0).nodeName)&&this.createDummyDiv(),setTimeout((()=>{this.root.event.emit("text:change",this.board.innerHTML)}),10)})),this.createDummyDiv()}createDummyDiv(){const t=document.createElement("div"),e=document.createElement("br");t.appendChild(e),0===this.board.childNodes.length?this.board.appendChild(t):this.board.replaceChild(t,this.board.childNodes.item(0))}getValue(){return this.hiddenTextArea.value}render(){const t=document.createElement("div");this.parent.appendChild(t),this.board=t,this.board.style.setProperty("min-height","150px"),this.board.style.border="1px solid #aeaeae";const e=document.createElement("textarea");this.hiddenTextArea=e,this.parent.appendChild(this.hiddenTextArea),this.textAreaSetting(),this.boardSetting()}}class T{constructor(t,e){this.board=t.querySelector(".board"),this.wrapper=document.createElement("div"),this.root=e,this.targetNode=void 0,[{top:"0%",left:"0%"},{top:"100%",left:"0%"},{top:"0%",left:"100%"},{top:"100%",left:"100%"}].map((t=>{const e=document.createElement("div");d(e,{...t,width:"16px",height:"16px","background-color":"black",position:"absolute",transform:"translate(-50%, -50%)","border-radius":"100%","z-index":"1000"}),e.dataset.type="point",e.dataset.value="100%"===t.left?"right":"left",e.dataset.yValue="100%"===t.top?"bottom":"top",this.wrapper.appendChild(e)})),t.appendChild(this.wrapper),this.render(),this.root.imageResizeStore.subscribe(this),this.wrapper.addEventListener("mousedown",this.mouseDownEventListener),t.addEventListener("mousemove",this.mouseMoveEventListener),t.addEventListener("mouseup",this.mouseUpEventListener),t.addEventListener("mouseleave",this.mouseUpEventListener)}update(){const t=this.root.imageResizeStore.state.selectedNode;if(t){const e=t.getClientRects().item(0);d(this.wrapper,{top:t.offsetTop-2+"px",left:t.offsetLeft-2+"px",display:"block",width:e.width+8+"px",height:e.height+8+"px"})}else d(this.wrapper,{display:"none",width:"0px",height:"0px"})}render(){d(this.wrapper,{position:"absolute",display:"none",border:"1px solid blue","z-index":"10"})}mouseDownEventListener=t=>{const e=h(t.target,"point");this.targetNode=this.root.imageResizeStore.state.selectedNode,e&&this.targetNode&&(t.preventDefault(),this.startPosition=e.dataset.value,this.startYPosition=e.dataset.yValue,this.currentXPoint=t.x,this.currentYPoint=t.y)};mouseMoveEventListener=t=>{this.startPosition&&(this.targetNode&&(console.log("mobe?"),t.preventDefault(),"IMG"===this.targetNode.nodeName?this.resizingImg(t.x):this.resizingVideo(t.x,t.y),this.update()),this.currentXPoint=t.x,this.currentYPoint=t.y)};resizingVideo(t,e){this.resizingImg(t);let n=0;this.targetNode.style.setProperty("height","0px");const s=this.targetNode.style.getPropertyValue("padding-bottom").split("%")[0];n="top"===this.startYPosition?this.calculatePercent(this.currentYPoint-e,Number(s)):this.calculatePercent(e-this.currentYPoint,Number(s)),n<5&&(n=5),this.targetNode.style.setProperty("padding-bottom",`${n}%`)}resizingImg(t){const e=this.root.imageResizeStore.state.selectedNode.style.getPropertyValue("width"),n=e?Number(e.split("%")[0]):100;let s=0;s="left"===this.startPosition?this.calculatePercent(this.currentXPoint-t,n):this.calculatePercent(t-this.currentXPoint,n),s>100&&(s=100),s<3&&(s=3),this.targetNode.style.setProperty("width",`${s}%`)}calculatePercent(t,e){const n=this.root.imageResizeStore.state.selectedNode,s=e||n.style.getPropertyValue("width").split("%")[0];return t>0?Number(s)+.1:t<0?Number(s)-.1:Number(s)}calculateNextYPx(t){return this.root.imageResizeStore.state.selectedNode.clientHeight+t}mouseUpEventListener=t=>{this.startPosition=void 0,this.currentXPoint=void 0,this.targetNode=void 0,this.currentYPoint=void 0,this.startYPosition=void 0}}class z{constructor(){this.textDecorationValues=[]}}const F=class extends n{constructor(t,e){super(new z),this.parent=t,this.event=e,this.rangeNodes=[],document.addEventListener("selectionchange",(t=>{const e=this.parent.querySelector(".board"),n=document.getSelection(),s=n.getRangeAt(0);if(o(e,s.startContainer)&&o(e,s.endContainer)){if(this.selection=n,this.range=s,this.type=this.selection.type,this.anchorNode=this.selection.anchorNode,this.focusNode=this.selection.focusNode,this.anchorNode===this.focusNode){const t=((t,e)=>{let n=this.anchorNode;const s={};for(;n;)n instanceof HTMLElement&&(s[n.style.getPropertyValue("text-decoration-line")]=1),n=n.parentElement;return Object.keys(s)})();this.setState({textDecorationValues:t})}this.setState({})}}))}setStyle(t,e){if(this.loadTmp(),"Range"===this.type){this.setRangeNode(),this.nextRange=document.createRange(),this.rangeEventListener(t,e);const n=window.getSelection();n.removeAllRanges(),n.addRange(this.nextRange)}"Caret"===this.type&&(e?this.insertNodeAndFoucs(e):this.caretEventListener(t)),this.initializeTmp();const n=this.parent.querySelector(".board"),s=[];n.childNodes.forEach((t=>s.push(t.outerHTML))),this.event.emit("history:setNextChild",s),this.event.emit("text:change",n.innerHTML)}insertImage(t){this.loadTmp();const e=document.createElement("img");e.src=t,d(e,{"max-width":"100%"}),this.insertNodeAndFoucs(e),this.initializeTmp()}saveTmp(){this.tmpFocusSelection=this.selection,this.tmpFocusRange=this.range,this.tmpFocusType=this.type,this.tmpRangeNodes=this.rangeNodes,this.tmpFocusNode=this.focusNode,this.tmpAnchorNode=this.anchorNode}initializeTmp(){this.tmpFocusSelection=void 0,this.tmpFocusRange=void 0,this.tmpFocusType=void 0,this.tmpRangeNodes=void 0,this.tmpFocusNode=void 0,this.tmpAnchorNode=void 0}insertNodeAndFoucs(t){const e=this.parent.querySelector(".board");if(this.range&&o(e,this.range.startContainer)&&o(e,this.range.endContainer)){this.range.insertNode(t),this.changeFocusNode(t);const n=[];e.childNodes.forEach((t=>n.push(t.outerHTML))),this.event.emit("history:setNextChild",n),this.event.emit("text:change",e.innerHTML)}}changeFocusNode(t){this.parent.focus();const e=document.createRange();e.selectNode(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e)}loadTmp(){this.selection=this.tmpFocusSelection||this.selection,this.range=this.tmpFocusRange||this.range,this.type=this.tmpFocusType||this.type,this.rangeNodes=this.tmpRangeNodes||this.rangeNodes,this.focusNode=this.tmpFocusNode||this.focusNode,this.anchorNode=this.tmpAnchorNode||this.anchorNode}caretEventListener(t){const e=document.createElement("span");d(e,t),e.innerHTML="&nbsp;",this.insertNodeAndFoucs(e)}oneNodeChange(t,e){const n=this.focusNode,s=document.createDocumentFragment();let i;if(e)i=e.cloneNode(!0),d(i,t);else{const e=document.createElement("span");d(e,t),i=e}const o=n.textContent,r=document.createTextNode(o.slice(0,this.range.startOffset));i.textContent=o.slice(this.range.startOffset,this.range.endOffset);const a=document.createTextNode(o.slice(this.range.endOffset));s.appendChild(r),s.appendChild(i),s.appendChild(a),"#text"===n.nodeName?n.parentElement.replaceChild(s,n):n.replaceChild(s,n)}rangeEventListener(t,e){this.anchorNode!==this.focusNode?this.rangeNodes.map(((n,s,i)=>{if(0===s||s===i.length-1){const i=e?((t,e,n,s)=>{const i=n?t.startOffset:t.endOffset,[o,r]=((t,e,n,s)=>{const i=document.createDocumentFragment(),o=t.textContent,r=[o.slice(0,e),o.slice(e)];s.textContent=r[n];const a=document.createTextNode(r[1===n?0:1]);return n?(i.appendChild(a),i.appendChild(s)):(i.appendChild(s),i.appendChild(a)),[i,s]})(e,i,n?1:0,s);return e.parentElement.replaceChild(o,e),r})(this.range,n,0===s,e.cloneNode(!0)):((t,e,n,s)=>{const i=s?t.startOffset:t.endOffset,[o,r]=((t,e,n,s)=>{const i=document.createDocumentFragment(),o=t.textContent,r=[o.slice(0,e),o.slice(e)],a=document.createElement("span");d(a,s),a.textContent=r[n];const h=document.createTextNode(r[1===n?0:1]);return n?(i.appendChild(h),i.appendChild(a)):(i.appendChild(a),i.appendChild(h)),[i,a]})(e,i,s?1:0,n);return e.parentElement.replaceChild(o,e),r})(this.range,n,t,0===s);0===s?this.nextRange.setStart(i,0):this.nextRange.setEnd(i,1)}else if(e){const t=e.cloneNode(!0);t.innerHTML=n.innerHTML,"#text"!==n.nodeName&&n.replaceChildren(t),t.childNodes.forEach((e=>{"#text"!==e.nodeName&&a(e,t.nodeName)}))}else d(n,t),n.childNodes.forEach((e=>{"#text"!==e.nodeName&&r(e,t)}))})):this.oneNodeChange(t,e)}setRangeNode(){let t=!1;const e=this.parent.querySelector(".board");this.rangeNodes=[];const n=e=>{if(this.range.startContainer===e||this.range.endContainer===e)return this.rangeNodes.push(e),void(t=!t);if(o(e,this.range.endContainer))e.childNodes.forEach((t=>n(t)));else{if(t)return void this.rangeNodes.push(e);e.childNodes.forEach((t=>n(t)))}};n(e)}};class R{constructor(){this.selectedNode=void 0}}const P=class extends n{constructor(){super(new R)}setSelectedNode(t){this.setState({selectedNode:t})}setInitlization(){this.setState({selectedNode:void 0})}};class H{constructor(){this.color="#000000",this.background="#ffffff"}}const B=class extends n{constructor(){super(new H)}setColor(t){this.setState({color:t})}setBackgroundColor(t){this.setState({background:t})}};function O(t,e,n){const s=[];for(let i=n;i<t.length;i++){if(t[i]===e)return{result:i,diff:s};s.push(t[i])}return{result:-1,diff:s}}class D{}const A=class extends n{constructor(t){super(new D),this.currentChild=[],this.undoHistory=[],this.redoHistory=[],this.event=t,this.event?.on("history:setNextChild",this.setNextChild.bind(this))}undo(){if(this.undoHistory.length){const t=this.undoHistory.pop();let e=this.currentChild.length;const n=t.filter((t=>"insert"===t.type)).reduce(((t,n)=>(t[n.line]=!0,e<n.line&&(e=n.line+1),t)),{}),s=t.filter((t=>"delete"===t.type)).reduce(((t,n)=>(t[n.line]=n.value,e<n.line&&(e=n.line+1),t)),{}),i=[];for(let t=0;t<e;t++)void 0!==s[t]&&i.push(s[t]),n[t]||i.push(this.currentChild[t]);return this.currentChild=i,this.redoHistory.push(t),this.event?.emit("text:change",this.currentChild.join("")),this.currentChild}}redo(){if(this.redoHistory.length){const t=this.redoHistory.pop();let e=this.currentChild.length;const n=t.filter((t=>"insert"===t.type)).reduce(((t,n)=>(t[n.line]=n.value,e<n.line+1&&(e=n.line+1),t)),{}),s=t.filter((t=>"delete"===t.type)).reduce(((t,n)=>(t[n.line]=!0,e<n.line+1&&(e=n.line+1),t)),{}),i=[];for(let t=0;t<e;t++)void 0!==n[t]&&i.push(n[t]),s[t]||i.push(this.currentChild[t]);return this.currentChild=i,this.undoHistory.push(t),this.event?.emit("text:change",this.currentChild.join("")),this.currentChild}}setNextChild(t,e){return e?(this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.diffToNextChild(t)}),500),[]):(this.timer&&clearTimeout(this.timer),this.diffToNextChild(t))}diffToNextChild(t){const e=this.diffChild(t);return 0===e.length?[]:(this.redoHistory=[],e.sort(((t,e)=>t.line===e.line?"delete"===t.type?-1:1:t.line-e.line)),this.undoHistory.push(e),this.setState({}),this.currentChild=t,e)}diffChild(t){const e=[];let n=0,s=0;for(;n<t.length||s<this.currentChild.length;){if(t[n]===this.currentChild[s]){n++,s++;continue}if(t.length===this.currentChild.length){e.push({type:"insert",line:n,value:t[n]}),e.push({type:"delete",line:s,value:this.currentChild[s]}),n++,s++;continue}if(n===t.length){if(this.currentChild[s]){e.push({line:s,value:this.currentChild[s],type:"delete"}),s++;continue}break}if(s===this.currentChild.length){if(t[n]){e.push({line:n,value:t[n],type:"insert"}),n++;continue}break}const i=O(t,this.currentChild[s],n);if(-1!==i.result){i.diff.map(((t,s)=>e.push({value:t,type:"insert",line:n+s}))),n=i.result+1,s++;continue}const o=O(this.currentChild,t[n],s);-1===o.result?-1===i.result&&-1===o.result&&(e.push({value:this.currentChild[s],type:"delete",line:s}),e.push({value:t[n],type:"insert",line:n}),n++,s++):(o.diff.map(((t,n)=>e.push({value:t,type:"delete",line:s+n}))),s=o.result+1,n++)}return e}};new class{constructor(t,e){const n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error("element is Not Defined");const s=new class{constructor(){this.listeners={}}on(t,e){this.listeners[t]?this.listeners[t].find((t=>t===e))||this.listeners[t].push(e):this.listeners[t]=[e]}emit(t,...e){setTimeout((()=>{this.listeners[t]&&this.listeners[t].map((t=>t(...e)))}),1)}removeListener(t,e){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter((t=>t!==e)))}};this.event=s,this.stores={event:s,history:new A(s),range:new F(n,s),imageResizeStore:new P,fontColorStore:new B},this.options=e,d(n,{"box-sizing":"border-box",position:"relative"}),this.root=n,this.render()}render(){new k(this.root,this.options,this.stores);const t=new M(this.root,this.options,this.stores);new T(this.root,this.stores),this.board=t.board,this.root.addEventListener("click",this.clickEventListener)}clickEventListener=t=>{const e=(t=>{let e=t;for(;e;){if("IMG"===e.nodeName||"IFRAME"===e.dataset.nodeName)return e;e=e.parentElement}return null})(t.target);e?this.stores.imageResizeStore.setSelectedNode(e):this.stores.imageResizeStore.setInitlization()};insertNode(t){this.stores.range.insertNodeAndFoucs(t)}setRangeStyle(t){this.stores.range.setStyle(t)}undo(){const t=this.stores.history.undo();t&&(this.root.querySelector(".board").innerHTML=t.join(""))}redo(){const t=this.stores.history.redo();t&&(this.root.querySelector(".board").innerHTML=t.join(""))}on(t,e){this.event.on(t,e)}emit(t,...e){this.event.emit(t,...e)}removeListener(t,e){this.event.removeListener(t,e)}get undoHistory(){return this.stores.history.undoHistory}get redoHistory(){return this.stores.history.redoHistory}}("#root",{image:{onUploadSingle:async t=>URL.createObjectURL(t)}}).on("text:change",(t=>{console.log(t)}))})();